RS.Controls={},RS.Controls.Control=function(a,b,c){var d=this;this.Options={Templates:null,IsEnabled:!0,Content:null,KeepOptionsFromStart:!1},a&&(d.Options=$.extend(d.Options,a)),d.Options=$.extend(d.Options,RS.Utils.getOptionsFromAttributes(b,"data-options")),this.Elements={Me:b},this.PubSub=new RS.PubSub,this.initialize=function(){return console.log("control"),d.initializeFromContainer(),d.initializeHtml(),d},this.initializeHtml=function(){return d.Elements.Me?(d.Elements.Me.data("control",d),e(d.Options.IsEnabled),d):d},this.initializeFromContainer=function(){if(!b)return d;var a=b.attr("data-template"),c=b.attr("data-item-template");if(!a&&!c)return d;var e=d.getDefaultTemplate();return e||(e={IsDefault:!0},d.Options.Templates||(d.Options.Templates=[]),d.Options.Templates.push(e)),a&&(e.Id=a),c&&(e.ItemTemplateId=c),d},this.appendTo=function(a,b){if(!(!a||d.Elements.Me&&a&&d.Elements.Me.parent()[0]==a[0])){if(d.Elements.Me)d.Elements.Me.remove();else{var c=d.generateHtml();if(!c)return;d.Elements.Me=$(c),d.Elements.Me.data("control",d)}var e=d.getChildren();if(e)for(var f=d.getChildrenContainer(),g=0;g<e.length;g++)e[g].appendTo(f);if(b){var h=a.attr("id");a.replaceWith(d.Elements.Me),h&&d.Elements.Me.attr("id",h)}else a.append(d.Elements.Me);return d.initializeHtml()}},this.generateHtml=function(){var a=d.getDefaultTemplate();if(!a)return null;if(a.Compiled=a.Compiled||Handlebars.compile($("#"+a.Id).html()),!a.Compiled)return null;var b=a.Compiled({Control:d});return b},this.getTemplate=function(a){return d.Options.Templates&&d.Options.Templates.length?d.Options.Templates.findFirstKeyValue("Name",a):null},this.getDefaultTemplate=function(){if(!d.Options.Templates||!d.Options.Templates.length)return null;var a=d.Options.Templates.findFirstKeyValue("IsDefault",!0)||d.Options.Templates[0];return a},this.getChildrenContainer=function(){if(!d.Elements.Me)return null;var a=d.Elements.Me.find('[role="main"]:first');return a.length||(a=d.Elements.Me),a},this.setContent=function(a){d.Options.Content=a;var b=d.getChildrenContainer();if(b)return b.empty().append(a),d},this.disable=function(){e(!1)},this.enable=function(){e(!0)};var e=function(a){d.Elements.Me&&(d.Options.IsEnabled=a,a?d.Elements.Me.removeAttr("disabled"):d.Elements.Me.attr("disabled","disabled"))};this.getChildren=function(){return null},c||d.initialize()},RS.Controls.DataSource=function(a,b){var c=this;this.Options={Data:null,RemoteCall:{Url:null,Type:"GET"},Paging:{IsEnabled:!0},IsCaseSensitive:!1},a&&(this.Options=$.extend(this.Options,a)),this.PubSub=null,this.IsLoading=!1,this.Parameters=null,this.PageIndex=-1;var d=-1;this.initialize=function(){return c.PubSub=new RS.PubSub,c.PubSub.addEvent("refresh"),c.PubSub.addEvent("add"),c.PubSub.addEvent("remove"),c.PubSub.addEvent("clear"),c},this.goToNextPage=function(a){c.goToPage(c.PageIndex+1,a)},this.goToPage=function(b,d){a=a||{},a.PageIndex=b,c.loadData(a,d)},this.refresh=function(a,b){c.Options.Data&&c.Options.RemoteCall.Url&&c.clear({IsRefresh:!0}),a=a||{},a.IsRefresh=!0,c.loadData(a,b)},this.loadData=function(a,b){c.Options.RemoteCall.Url?f(a,function(c){i(a,c),b&&b()}):h(a,function(c){i(a,c),b&&b()})},this.clear=function(a){c.PageIndex=-1,c.Options.Data=null,c.PubSub.triggerEvent("clear",{Source:c,Options:a})},this.addItem=function(a,b){if(!a)return c;if(c.Options.Data=c.Options.Data||[],b=Math.max(0,Math.min(c.Options.Data.length-1,b||c.Options.Data.length-1)),a instanceof Array)for(var d=0;d<a.length;d++)c.Options.Data.splice(b+d,0,a);else c.Options.Data.splice(b,0,a);return c.PubSub.triggerEvent("add",{Source:c,Items:a,Index:b}),c},this.removeItem=function(a,b){return c.Options.Data?(b=b||1,c.Options.Data.splice(a,b),c.PubSub.triggerEvent("add",{Source:c,Index:a,Number:b}),c):c},this.setParameter=function(a,b){c.Parameters=e(c.Parameters,a,b)},this.getParameterValue=function(a){if(!c.Parameters)return null;var b=c.Parameters.findFirst(function(b,c){return b.Name==a});return b?b.Value:null};var e=function(a,b,c){if(b){a||(a=[]);for(var d=!1,e=0;e<a.length;e++){var f=a[e];if(f.Name==b){f.Value=c,d=!0;break}}return d||a.push({Name:b,Value:c}),a}},f=function(a,b){if(c.Options.RemoteCall){c.IsLoading=!0;var e=g(c.Parameters);c.Options.Paging.IsEnabled&&(e=e||{},e.pageIndex=a?a.PageIndex:0,d=e.pageIndex),c.Options.RemoteCall.Url&&RS.Remote.call(c.Options.RemoteCall.Url,e,function(a){c.Options.Paging.IsEnabled&&(c.PageIndex=Math.max(c.PageIndex,e.pageIndex||0)),e.pageIndex==d&&(c.IsLoading=!1),b&&b(a)},c.Options.RemoteCall.Type)}},g=function(a){if(!a)return null;for(var b={},c=0;c<a.length;c++){var d=a[c];b[d.Name]=d.Value}return b},h=function(a,b){var d=c.Options.Data;if(d){var e=c.getParameterValue("term");e&&(c.Options.IsCaseSensitive&&(e=e.toLowerCase()),d=d.filter(function(a,b){return a&&a.Text&&(c.Options.IsCaseSensitive&&a.Text.indexOf(e)>-1||!c.Options.IsCaseSensitive&&a.Text.toLowerCase().indexOf(e)>-1)}))}return b&&b(d),d},i=function(a,b){if(c.Options.Data=c.Options.Data||[],c.Options.RemoteCall.Url&&b)if(b instanceof Array)for(var d=0;d<b.length;d++)c.Options.Data.push(b[d]);else c.Options.Data.push(b);c.PubSub.triggerEvent("refresh",{Source:c,Options:a,Data:b})};b||c.initialize()},RS.Controls.Container=function(a,b,c){var d=this;this.Options={Templates:[{IsDefault:!0,Id:"container-template"}]},a&&(d.Options=$.extend(d.Options,a)),RS.Controls.Container.superclass.constructor.call(this,d.Options,b,!0),this.getChildrenContainer=function(){return d.Elements.Me?d.Elements.Me.find('[role="main"]:first'):null},c||d.initialize()},extend(RS.Controls.Container,RS.Controls.Control),RS.Controls.NotificationTypes={Success:"alert-success",Info:"alert-info",Warning:"alert-warning",Danger:"alert-danger"},RS.Controls.Notification=function(a,b,c){var d=this;this.Options={Templates:[{IsDefault:!0,Id:"notification-template"}],Type:RS.Controls.NotificationTypes.Info,Title:null,Message:null,IsPinned:!1,Position:{Top:null,Right:null,Bottom:null,Left:null},AutoHide:!0,AutoHideAfter:5e3,HideOnClick:!0};var e=null;a&&(d.Options=$.extend(d.Options,a)),RS.Controls.Notification.superclass.constructor.call(this,d.Options,b,!0),this.initializeHtml=override(d.initializeHtml,function(){return d.Elements.Me?(d.Elements.Me.css({position:d.Options.IsPinned?"fixed":"relative",top:d.Options.Position.Top,right:d.Options.Position.Right,bottom:d.Options.Position.Bottom,left:d.Options.Position.Left}),d.Elements.Me.bind("mousedown",function(a){return d.Options.HideOnClick?(d.hide(),!1):void 0}),d.Elements.Me.find('[role="close"]').click(function(a){return d.hide(),!1}),d):d}),this.show=function(){return d.Elements.Me?(d.Elements.Me.show(),d.Options.AutoHide&&d.Options.AutoHideAfter&&(e&&clearTimeout(e),e=setTimeout(function(){d.hide()},d.Options.AutoHideAfter)),d):d},this.hide=function(){return d.Elements.Me?(e&&clearTimeout(e),d.Elements.Me.remove(),d):d},this.setType=function(a){return a=a||RS.Controls.NotificationTypes.Info,d.Options.Type=a,d.Elements.Me?(d.Elements.Me.removeClass("alert-success alert-info alert-warning alert-danger").addClass(a),d):d},this.initializeFromContainer=override(d.initializeFromContainer,function(){return b?(d.Options.Title=f(),d.Options.Message=g(),d.Options.Type=h(),d):void 0}),this.setTitle=function(a){return d.Options.Title=a,d.Elements.Me?(d.Elements.Me.find('[role="title"]').text(a),d):d};var f=function(){return d.Elements.Me?d.Elements.Me.find('[role="title"]').text():null};this.setMessage=function(a){return d.Options.Message=a,d.Elements.Me?(d.Elements.Me.find('[role="message"]').text(a),d):d};var g=function(){return d.Elements.Me?d.Elements.Me.find('[role="message"]').text():null},h=function(){return d.Elements.Me?d.Elements.Me.hasClass("alert-success")?RS.Controls.NotificationTypes.Success:d.Elements.Me.hasClass("alert-info")?RS.Controls.NotificationTypes.Info:d.Elements.Me.hasClass("alert-warning")?RS.Controls.NotificationTypes.Warning:d.Elements.Me.hasClass("alert-danger")?RS.Controls.NotificationTypes.Danger:RS.Controls.NotificationTypes.Info:RS.Controls.NotificationTypes.Info};c||d.initialize()},extend(RS.Controls.Notification,RS.Controls.Control),RS.Controls.Notifier=function(a,b,c){var d=this;this.Options={IsPinned:!1,Position:{Top:null,Right:null,Bottom:null,Left:null},AutoHide:!0,AutoHideAfter:5e3,HideOnClick:!0,Container:null},a&&(d.Options=$.extend(d.Options,a)),d.Options.Container=d.Options.Container||$("body");var e=null;RS.Controls.Notifier.superclass.constructor.call(this,d.Options,b,!0),this.show=function(a,b,c){e&&e.hide(),e=new RS.Controls.Notification({Title:c,Message:b,IsPinned:d.Options.IsPinned,Position:d.Options.Position,AutoHide:d.Options.AutoHide,AutoHideAfter:d.Options.AutoHideAfter,HideOnClick:d.Options.HideOnClick,Type:a}),e.appendTo(d.Options.Container),e.show()},this.showInfo=function(a,b){return d.show(RS.Controls.NotificationTypes.Info,a,b)},this.showWarning=function(a,b){return d.show(RS.Controls.NotificationTypes.Warning,a,b)},this.showDanger=function(a,b){return d.show(RS.Controls.NotificationTypes.Danger,a,b)},this.showSuccess=function(a,b){return d.show(RS.Controls.NotificationTypes.Success,a,b)},c||d.initialize()},extend(RS.Controls.Notifier,RS.Controls.Control),RS.Controls.ButtonTypes={Default:"default",Primary:"primary",Success:"success",Info:"info",Warning:"warning",Danger:"danger",Link:"link"},RS.Controls.ButtonSizes={ExtraSmall:"btn-xs",Small:"btn-sm",Default:"",Large:"btn-lg"},RS.Controls.Orientations={Horizontal:"Horizontal",Vertical:"Vertical"},RS.Controls.Button=function(a,b,c){var d=this;this.Options={Type:RS.Controls.ButtonTypes.Default,Templates:[{IsDefault:!0,Id:"button-default-template"}],Size:RS.Controls.ButtonSizes.Default,IsBlock:!1,Icon:null,Image:null,Text:null},a&&(d.Options=$.extend(d.Options,a)),RS.Controls.Button.superclass.constructor.call(this,d.Options,b,!0),this.initialize=override(d.initialize,function(){return console.log("button"),d.PubSub.addEvent("click"),d}),this.initializeHtml=override(d.initializeHtml,function(){return d.applyOptions(),d.Elements.Me?(d.Elements.Me.click(function(a){d.PubSub.triggerEvent("click",{Event:a,Source:d})}),d):d}),this.applyOptions=function(a){a=a||d.Options,d.setType(d.Options.Type),d.setSize(d.Options.Size),d.setBlock(d.Options.IsBlock),d.Options.Icon&&d.setIcon(d.Options.Icon),d.Options.Image&&d.setImage(d.Options.Image),d.Options.Text&&d.setText(d.Options.Text)},this.initializeFromContainer=override(d.initializeFromContainer,function(){return!b||d.Options.KeepOptionsFromStart?d:(d.Options.Type=e(),d.Options.Size=f(),d.Options.Text=g(),d.Options.IsBlock=b.hasClass("btn-block"),d.Options.Icon=(b.find('[role="img"]:first .glyphicon:first').attr("class")||"").replace("glyphicon-","").replace("glyphicon","").trim(),d.Options.Image=b.find('[role="img"]:first img:first').attr("src"),d)}),this.setType=function(a){return a=a||RS.Controls.ButtonTypes.Default,d.Options.Type=a,d.Elements.Me?(d.Elements.Me.removeClass("btn-default btn-primary btn-success btn-info btn-warning btn-danger btn-link").addClass("btn-"+a),d):d},this.setSize=function(a){return a=a||RS.Controls.ButtonSizes.Default,d.Options.Size=a,d.Elements.Me?(d.Elements.Me.removeClass("btn-xs btn-sm btn-lg").addClass(a),d):d},this.setBlock=function(a){return d.Options.IsBlock=a,d.Elements.Me?(a&&!d.Elements.Me.hasClass("btn-block")?d.Elements.Me.addClass("btn-block"):d.Elements.Me.removeClass("btn-block"),d):d},this.getChildrenContainer=function(){return d.Elements.Me?d.Elements.Me.find('[role="main"]:first'):null},this.setText=function(a){return d.Options.Text=a,d.setContent(a),d},this.setIcon=function(a){return d.Options.Icon=a,d.Elements.Me?(a?d.Elements.Me.find('[role="img"]').html('<span class="glyphicon glyphicon-'+a+'" aria-hidden="true"></span>'):d.Elements.Me.find('[role="img"]').empty(),d):d},this.setImage=function(a){return d.Options.Image=a,d.Elements.Me?(a?d.Elements.Me.find('[role="img"]').html('<img src="'+a+'" />'):d.Elements.Me.find('[role="img"]').empty(),d):d};var e=function(){return d.Elements.Me?d.Elements.Me.hasClass("btn-primary")?RS.Controls.ButtonTypes.Primary:d.Elements.Me.hasClass("btn-success")?RS.Controls.ButtonTypes.Success:d.Elements.Me.hasClass("btn-info")?RS.Controls.ButtonTypes.Info:d.Elements.Me.hasClass("btn-warning")?RS.Controls.ButtonTypes.Warning:d.Elements.Me.hasClass("btn-danger")?RS.Controls.ButtonTypes.Danger:d.Elements.Me.hasClass("btn-link")?RS.Controls.ButtonTypes.Link:RS.Controls.ButtonTypes.Default:RS.Controls.ButtonTypes.Default},f=function(){return d.Elements.Me?d.Elements.Me.hasClass("btn-xs")?RS.Controls.ButtonSizes.ExtraSmall:d.Elements.Me.hasClass("btn-sm")?RS.Controls.ButtonSizes.Small:d.Elements.Me.hasClass("btn-lg")?RS.Controls.ButtonSizes.Large:RS.Controls.ButtonSizes.Default:RS.Controls.ButtonSizes.Default},g=function(){return d.Elements.Me?d.Elements.Me.find('[role="main"]').text():null};c||d.initialize()},extend(RS.Controls.Button,RS.Controls.Control),RS.Controls.ToggleButton=function(a,b,c){var d=this;this.Options={IsChecked:!1,CanToggle:!0},a&&(d.Options=$.extend(d.Options,a)),RS.Controls.ToggleButton.superclass.constructor.call(this,d.Options,b,!0),this.initialize=override(d.initialize,function(){return console.log("togglebutton"),d.PubSub.addEvent("toggle"),d.PubSub.addListener("click",function(){d.setChecked(!d.Options.IsChecked)}),d}),this.initializeHtml=override(d.initializeHtml,function(){return d.setChecked(d.Options.IsChecked),d}),this.initializeFromContainer=override(d.initializeFromContainer,function(){return b?(d.Options.IsChecked=e(),d):void 0}),this.setChecked=function(a){return d.Options.IsChecked!=a&&d.Options.CanToggle?(d.Options.IsChecked=a,d.PubSub.triggerEvent("toggle",{Source:d,IsChecked:a}),d.Elements.Me?(a?d.Elements.Me.hasClass("active")||d.Elements.Me.addClass("active"):d.Elements.Me.removeClass("active"),d):d):d};var e=function(){return d.Elements.Me?d.Elements.Me.hasClass("active"):!1};c||d.initialize()},extend(RS.Controls.ToggleButton,RS.Controls.Button),RS.Controls.ButtonGroup=function(a,b,c){var d=this;this.Options={Templates:[{IsDefault:!0,Id:"button-group-template"}],Size:RS.Controls.ButtonSizes.Default,Orientation:RS.Controls.Orientations.Horizontal,IsJustified:!1,Buttons:[],AllowMultipleToggle:!0},a&&(d.Options=$.extend(d.Options,a)),RS.Controls.ButtonGroup.superclass.constructor.call(this,d.Options,b,!0),this.initialize=override(d.initialize,function(){if(console.log("buttongroup"),d.Options.Buttons)for(var a=0;a<d.Options.Buttons.length;a++)d.addButton(d.Options.Buttons[a],!0);return d.PubSub.addEvent("select"),d}),this.initializeHtml=override(d.initializeHtml,function(){return d.setSize(d.Options.Size),d.setOrientation(d.Options.Orientation),d.setJustification(d.Options.IsJustified),d}),this.setSize=function(a){if(a=a||RS.Controls.ButtonSizes.Default,d.Options.Size=a,!d.Elements.Me)return d;d.Elements.Me.removeClass("btn-group-xs btn-group-sm btn-group-lg");var b="";switch(a){case RS.Controls.ButtonSizes.ExtraSmall:b="btn-group-xs";break;case RS.Controls.ButtonSizes.Small:b="btn-group-sm";break;case RS.Controls.ButtonSizes.Large:b="btn-group-lg"}return b&&d.Elements.Me.addClass(b),d},this.setJustification=function(a){return d.Options.IsJustified=a,d.Elements.Me?(a?d.Elements.Me.addClass("btn-group-justified"):d.Elements.Me.removeClass("btn-group-justified"),d):d},this.setOrientation=function(a){return a=a||RS.Controls.Orientations.Horizontal,d.Options.Orientation=a,d.Elements.Me?(d.Elements.Me.removeClass("btn-group btn-group-vertical").addClass(a==RS.Controls.Orientations.Horizontal?"btn-group":"btn-group-vertical"),d):d},this.addButton=function(a,b,c){return a?(d.Options.Buttons=d.Options.Buttons||[],b||d.Options.Buttons.push(a),d.Elements.Me&&!c&&a.appendTo(d.getChildrenContainer()),a instanceof RS.Controls.ToggleButton&&a.PubSub.addListener("toggle",function(b){if(b.IsChecked&&!d.Options.AllowMultipleToggle&&a instanceof RS.Controls.ToggleButton){a.Options.CanToggle=!1;for(var c=0;c<d.Options.Buttons.length;c++){var e=d.Options.Buttons[c];e!=a&&e instanceof RS.Controls.ToggleButton&&(e.Options.CanToggle=!0,e.setChecked(!1))}}}),a.PubSub.addListener("click",function(b){b.Index=d.Options.Buttons.findFirstIndex(function(b,c){return b==a}),b.Button=a,d.PubSub.triggerEvent("select",b)}),d):d},this.removeButton=function(a){if(!a||!d.Options.Buttons)return d;var b=d.Options.Buttons.findFirstIndex(function(b,c){return b==a});return 0>b?d:(d.Options.Buttons.splice(b,1),void(a.Elements.Me&&a.Elements.Me.remove()))},this.initializeFromContainer=override(d.initializeFromContainer,function(){return b?(d.Options.Size=f(),d.Options.Orientation=g(),d.Options.IsJustified=h(),d.Options.Buttons=e(),d):void 0}),this.getChildrenContainer=function(){return d.Elements.Me},this.getChildren=function(){return d.Options.Buttons};var e=function(){return d.Elements.Me?void d.getChildrenContainer().find('> [role="button"]').each(function(){var a=$(this).getControl();a&&d.addButton(a,!1,!0)}):null},f=function(){return d.Elements.Me?d.Elements.Me.hasClass("btn-group-xs")?RS.Controls.ButtonSizes.ExtraSmall:d.Elements.Me.hasClass("btn-group-sm")?RS.Controls.ButtonSizes.Small:d.Elements.Me.hasClass("btn-group-lg")?RS.Controls.ButtonSizes.Large:RS.Controls.ButtonSizes.Default:RS.Controls.ButtonSizes.Default},g=function(){return d.Elements.Me&&d.Elements.Me.hasClass("btn-group-vertical")?RS.Controls.Orientations.Vertical:RS.Controls.Orientations.Horizontal},h=function(){return d.Elements.Me?d.Elements.Me.hasClass("btn-group-justified"):!1};c||d.initialize()},extend(RS.Controls.ButtonGroup,RS.Controls.Control),RS.Controls.ModalSizes={Small:"modal-sm",Default:"",Large:"modal-lg"},RS.Controls.ModalButton=function(a,b,c){var d=this;this.Options={IsDismiss:!1},a&&(d.Options=$.extend(d.Options,a)),RS.Controls.ModalButton.superclass.constructor.call(this,d.Options,b,!0),this.initialize=override(d.initialize,function(){console.log("modalbutton")}),c||d.initialize()},extend(RS.Controls.ModalButton,RS.Controls.Button),RS.Controls.Modal=function(a,b,c){var d=this;d.Options={Templates:[{IsDefault:!0,Id:"modal-template"}],Title:null,Buttons:null,DestroyAfterClose:!1,Parent:$("body"),Overlay:!1,Size:RS.Controls.ModalSizes.Default,Content:null,CloseOnClickOutside:!0},a&&(d.Options=$.extend(d.Options,a)),RS.Controls.Modal.superclass.constructor.call(this,d.Options,b,!0),this.Notifier=null,this.initialize=override(d.initialize,function(){return console.log("modal"),d.PubSub.addEvent("show"),d.PubSub.addEvent("hide"),d.PubSub.addEvent("destroy"),d.PubSub.addEvent("select"),d}),this.initializeFromContainer=override(d.initializeFromContainer,function(){return b?(d.Options.Title=e(),d.Options.Size=f(),d):void 0}),this.setContent=function(a){if(!d.Elements.Me)return d;var b=d.Elements.Me.find('[role="dialog"]:first [role="main"]:first');return b.empty().append(a),d},this.show=function(){if(!d.Elements.Me||!d.Elements.Me.parent()){if(d.Options.Parent=d.Options.Parent||$("body"),d.appendTo(d.Options.Parent),d.setSize(d.Options.Size),$(document).keydown(function(a){return a.keyCode==RS.Keys.ESCAPE?(d.hide(),!1):void 0}),d.Elements.Me.mousedown(function(a){d.Options.CloseOnClickOutside&&$(a.target)[0]==d.Elements.Me[0]&&d.hide()}),d.Options.Buttons)for(var a=d.Elements.Me.find('[role="footer"]'),b=0;b<d.Options.Buttons.length;b++){var c=d.Options.Buttons[b];c.PubSub.addListener("click",function(a){a.Index=d.Options.Buttons.findFirstIndex(function(b,c){return b==a.Source}),a.Button=a.Source,d.PubSub.triggerEvent("select",a),a.Button.Options.IsDismiss&&d.hide()}),c.appendTo(a)}d.Notifier=new RS.Controls.Notifier({Container:d.Elements.Me.find('[role="alert"]')})}if(!d.Elements.Me)return d;if(d.Options.Overlay){var e=d.Options.Parent.find(".modal-backdrop");e.length||d.Options.Parent.append('<div class="modal-backdrop fade in"></div>')}return d.Elements.Me.show(),d.PubSub.triggerEvent("show",{Source:d}),d},this.hide=function(){return d.Elements.Me?(d.Elements.Me.hide(),d.Options.Parent.find(".modal-backdrop").hide(),d.PubSub.triggerEvent("hide",{Source:d}),d.Options.DestroyAfterClose&&d.destroy(),d):d},this.destroy=function(){return d.Elements.Me?(d.Elements.Me.remove(),d.Elements.Me=null,d.PubSub.triggerEvent("destroy",{Source:d}),d):d},this.setTitle=function(a){return d.Options.Title=a,d.Elements.Me?(d.Elements.Me.find('[role="title"]').text(a),d):d},this.setSize=function(a){return a=a||RS.Controls.ModalSizes.Default,d.Options.Size=a,d.Elements.Me?(d.Elements.Me.find('[role="dialog"]').removeClass("modal-sm modal-lg").addClass(a),d):d};var e=function(){return d.Elements.Me?d.Elements.Me.find('[role="title"]').text():null},f=function(){if(!d.Elements.Me)return RS.Controls.ModalSizes.Default;var a=d.Elements.Me.find('[role="dialog"]');return a.hasClass(RS.Controls.ModalSizes.Small)?RS.Controls.ModalSizes.Small:a.hasClass(RS.Controls.ModalSizes.Large)?RS.Controls.ModalSizes.Large:RS.Controls.ModalSizes.Default};c||d.initialize()},extend(RS.Controls.Modal,RS.Controls.Control),RS.Controls.Tooltip=function(a,b,c){var d=this;this.Options={Templates:[{IsDefault:!0,Id:"tooltip-template"}],Parent:null,Content:null,Position:"top",AutoHide:!0,Trigger:"hover"};var e=null;a&&(d.Options=$.extend(d.Options,a)),RS.Controls.Tooltip.superclass.constructor.call(this,d.Options,b,!0),this.initialize=override(d.initialize,function(){return d.Options.Parent?(d.PubSub.addEvent("show"),d.PubSub.addEvent("hide"),d.Options.Parent.mousedown(function(a){"click"==d.Options.Trigger&&(d.Elements.Me&&d.Elements.Me.is(":visible")||d.show())}),d.Options.Parent.hover(function(){"hover"==d.Options.Trigger&&d.show()},function(){"hover"==d.Options.Trigger&&d.Options.AutoHide&&d.hide()}),d):d}),this.show=function(){d.Elements.Me||(d.appendTo(d.Options.Parent.parent()),d.Elements.Me.mousedown(function(a){return d.Options.AutoHide&&"click"!=d.Options.Trigger||d.hide(),!1}));var a=g(d.Options.Position);return e=d.Options.Position,a.y<0?(d.setPosition("bottom",!0),a=g("bottom")):a.x<0&&(d.setPosition("right",!0),a=g("right")),f(a),d.Elements.Me.offset().top+d.Elements.Me.outerHeight()>$(document).height()?(d.setPosition("top",!0),a=g("top"),f(a)):d.Elements.Me.offset().left+d.Elements.Me.outerWidth()>$(document).width()&&(d.setPosition("left",!0),a=g("left"),f(a)),d.Elements.Me.show(),d.PubSub.triggerEvent("show",{Source:d}),d},this.hide=function(){return d.Elements.Me?(d.Elements.Me.hide(),d.setPosition(d.Options.Position),d.PubSub.triggerEvent("hide",{Source:d}),d):d},this.setPosition=function(a,b){return a=a||"right",b||(d.Options.Position=a),d.Elements.Me?(d.Elements.Me.removeClass("top right bottom left").addClass(a),d):d};var f=function(a){d.Elements.Me&&a&&d.Elements.Me.css({left:a.x,top:a.y})},g=function(a){var b=0,c=0,e="fixed"==d.Options.Parent.css("position")?d.Options.Parent.offset():d.Options.Parent.position();return"top"==a?(b=e.left+d.Options.Parent.outerWidth()/2-d.Elements.Me.outerWidth()/2,c=e.top-d.Elements.Me.outerHeight()):"right"==a?(b=e.left+d.Options.Parent.outerWidth(),c=e.top+d.Options.Parent.outerHeight()/2-d.Elements.Me.outerHeight()/2):"bottom"==a?(b=e.left+d.Options.Parent.outerWidth()/2-d.Elements.Me.outerWidth()/2,c=e.top+d.Options.Parent.outerHeight()):"left"==a&&(b=e.left-d.Elements.Me.outerWidth(),c=e.top+d.Options.Parent.outerHeight()/2-d.Elements.Me.outerHeight()/2),{x:b,y:c}};c||d.initialize()},extend(RS.Controls.Tooltip,RS.Controls.Control),RS.Controls.Popover=function(a,b,c){var d=this;this.Options={Templates:[{IsDefault:!0,Id:"popover-template"}],Title:null},a&&(d.Options=$.extend(d.Options,a)),RS.Controls.Popover.superclass.constructor.call(this,d.Options,b,!0),this.setTitle=function(a){return d.Options.Title=a,d.Elements.Me?(d.Elements.Me.find('[role="title"]:first').text(a),d):d},c||d.initialize()},extend(RS.Controls.Popover,RS.Controls.Tooltip),RS.Controls.DataControl=function(a,b,c){var d=this;this.Options={DataSource:null,Paging:{HasContinuousPagination:!1,ContinuousPaginationScrollingParent:null},Search:{CanSearch:!1,Placeholder:"Search...",MinLength:3,Delay:250,IsCaseSensitive:!1},HighlightFirst:!0,CanSelect:!0,CanHighlight:!0,RefreshAfterDataSourceChanged:!0},a&&(d.Options=$.extend(d.Options,a)),RS.Controls.DataControl.superclass.constructor.call(this,d.Options,b,!0),this.HighlightedIndex=-1,this.SelectedIndex=-1,this.SelectedItem=null,this.Elements.List=null;var e=null,f=null,g=null,h=null;this.initialize=override(d.initialize,function(){return d.PubSub.addEvent("highlight"),d.PubSub.addEvent("select"),i(d.Options.DataSource),d}),this.initializeHtml=override(d.initializeHtml,function(){return d.Elements.Me?(d.Elements.Search=d.Elements.Me.find('[role="popover"]:first input'),d.Elements.List="list"==d.Elements.Me.attr("role")?d.Elements.Me:d.Elements.Me.find('[role="list"]:first'),d.setCanSearch(d.Options.Search.CanSearch),d.setPlaceholder(d.Options.Search.Placeholder),d.setContinuousPaginationScrollingParent(d.Options.Paging.ContinuousPaginationScrollingParent),d.Elements.List.on("click",'[role="listitem"]',function(a){var b=$(this),c=b.parent().children().index(b);d.highlightIndex(c),d.selectIndex(c)}),d.Elements.Search.keyup(function(a){return l(),!1}),d.Elements.Me.keydown(function(a){if(a.keyCode==RS.Keys.DOWN)return d.highlightIndex(d.HighlightedIndex+1),!1;if(a.keyCode==RS.Keys.UP)return d.highlightIndex(d.HighlightedIndex-1),!1;if(a.keyCode==RS.Keys.ENTER)return d.selectIndex(d.HighlightedIndex),!1;if(a.keyCode==RS.Keys.HOME&&!a.shiftKey)return d.highlightIndex(0),!1;if(a.keyCode==RS.Keys.END&&!a.shiftKey)return d.highlightIndex(1/0),!1;if(a.keyCode==RS.Keys.PAGE_UP||a.keyCode==RS.Keys.PAGE_DOWN){var b=Math.round(d.Elements.List.height()/(d.Elements.List.find('[role="listitem"]:first').height()||30));return a.keyCode==RS.Keys.PAGE_UP?d.highlightIndex(d.HighlightedIndex-b):d.highlightIndex(d.HighlightedIndex+b),!1}return!0}),d.Elements.Me.bind("focusin",function(a){if(d.IsOpen&&d.Options.Search.CanSearch&&d.Elements.Search){if($(a.target)[0]==d.Elements.Search[0])return!0;d.Elements.Search.focus()}}),d):d}),this.setContinuousPaginationScrollingParent=function(a){return d.Options.Paging.ContinuousPaginationScrollingParent=a,d.Options.Paging.HasContinuousPagination&&d.Options.Paging.ContinuousPaginationScrollingParent&&d.Options.Paging.ContinuousPaginationScrollingParent.scroll(function(){return d.checkIfShouldLoadNextPageForContinuousPagination()?!1:void 0}),d},this.checkIfShouldLoadNextPageForContinuousPagination=function(){if(!d.Options.DataSource||d.Options.DataSource.IsLoading||!d.Options.Paging.HasContinuousPagination||!d.Options.DataSource.Options.RemoteCall.Url)return!1;var a=d.Options.Paging.ContinuousPaginationScrollingParent;return a[0]==document&&$(window).scrollTop()+$(window).height()==$(document).height()?(d.Options.DataSource.goToNextPage(),!0):a.scrollTop()+a.innerHeight()>=a[0].scrollHeight?(d.Options.DataSource.goToNextPage(),!0):!1},this.setCanSearch=function(a){return d.Options.Search.CanSearch=a,d.Elements.Me?(a?(d.Options.DataSource&&(d.Options.DataSource.IsCaseSensitive=d.Options.Search.IsCaseSensitive),d.Elements.Search.show(),d.Elements.List.hasClass("search")||d.Elements.List.addClass("search")):(d.Elements.Search.hide(),d.Elements.List.removeClass("search")),d):d},this.setPlaceholder=function(a){return d.Options.Search.Placeholder=a,d.Elements.Me?(d.Elements.Search.attr("placeholder",a),d):d},this.highlightIndex=function(a){return d.Options.CanHighlight&&d.Options.DataSource&&d.Options.DataSource.Options.Data?(a=Math.max(0,Math.min(a||0,d.Options.DataSource.Options.Data.length-1)),d.HighlightedIndex==a?d:(e&&e.removeClass("active"),e=d.Elements.List.find('> [role="listitem"]:eq('+a+")"),e.addClass("active"),d.HighlightedIndex=a,k(e),d.PubSub.triggerEvent("highlight",{Source:d,Index:a}),d)):d},this.selectIndex=function(a){return d.Options.CanSelect&&d.Options.DataSource&&d.Options.DataSource.Options.Data?(a=Math.max(0,Math.min(a||0,d.Options.DataSource.Options.Data.length-1)),d.SelectedIndex==a?d:(d.SelectedIndex=a,d.SelectedItem=d.Options.DataSource.Options.Data[a],d.PubSub.triggerEvent("select",{Source:d,Index:a,Item:d.SelectedItem}),d)):d},this.setDataSource=function(a){return d.Options.DataSource==a?d:(d.Options.DataSource=a,i(a),a&&d.Options.RefreshAfterDataSourceChanged&&a.refresh(),d)};var i=function(a){a&&h!=a&&(h=a,d.Options.Search.CanSearch&&(a.Options.IsCaseSensitive=d.Options.Search.IsCaseSensitive),a.PubSub.addListener("refresh",function(a){m(a.Options,a.Data)}),a.PubSub.addListener("add",function(a){m({Index:a.Index},a.Items)}),a.PubSub.addListener("clear",function(a){j(a.Options)}))};this.search=function(a){(a||"")!=(f||"")&&(a&&d.Options.Search.MinLength&&(a||"").length<d.Options.Search.MinLength||(f=a,d.Options.DataSource.setParameter("term",a),d.Options.DataSource.refresh()))};var j=function(a){a&&a.IsRefresh||d.Elements.List&&(d.HighlightedIndex=-1,d.SelectedIndex=-1,d.SelectedItem=null,d.Elements.List.empty(),d.PubSub.triggerEvent("select",{Source:d,Index:-1,Item:null}))},k=function(a){if(a){var b=a.position();if(b){var c=-1;b.top<0?c=d.Elements.List.scrollTop()+b.top:b.top+a.height()>d.Elements.List.height()&&(c=d.Elements.List.scrollTop()+b.top+a.height()-d.Elements.List.height()),c>=0&&d.Elements.List.scrollTop(c)}}},l=function(){if(d.Elements.Search&&d.Options.Search.CanSearch&&d.Options.DataSource){var a=d.Elements.Search.val();g&&clearTimeout(g),d.Options.Search.Delay?g=setTimeout(function(){d.search(a)},d.Options.Search.Delay):d.search(a)}},m=function(a,b){if(console.log("render"),!d.Elements.Me)return d;if(a&&a.IsRefresh&&(j(),d.Elements.List.scrollTop()),b=b||[],!(b instanceof Array)){var c=[];c.push(b),b=c}var e=d.getDefaultTemplate();if(!e)return null;e.ItemCompiled=e.ItemCompiled||Handlebars.compile($("#"+e.ItemTemplateId).html());var f=e.ItemCompiled({Items:b}),g=d.Elements.List.children().length,h=Math.max(0,Math.min(g,a&&a.Index?a.Index-1:g));if(h>=g)d.Elements.List.append(f);else{var i=d.Elements.List.find('> [role="listitem"]:eq('+h+")");i.after(f)}return a&&a.IsRefresh&&d.Options.HighlightFirst&&d.highlightIndex(0),d};c||d.initialize()},extend(RS.Controls.DataControl,RS.Controls.Control),RS.Controls.Dropdown=function(a,b,c){var d=this;this.Options={Templates:[{IsDefault:!0,Id:"dropdown-template",ItemTemplateId:"dropdown-item-template",SelectedItemTemplateId:"dropdown-selected-item-template"}],SelectText:"Select",Paging:{HasContinuousPagination:!0},CloseAfterSelect:!0,CanSelect:!0,CanHighlight:!0},a&&(d.Options=$.extend(d.Options,a)),RS.Controls.Dropdown.superclass.constructor.call(this,d.Options,b,!0),this.Elements.Me=null,this.Elements.Popover=null,this.IsOpen=!1;var e=!1;this.initialize=override(d.initialize,function(){console.log("dropdown"),d.PubSub.addEvent("open"),d.PubSub.addEvent("close");var a=d.getDefaultTemplate();return a.SelectedItemTemplateId&&Handlebars.registerPartial("DropdownSelectedItemTemplate",$("#"+a.SelectedItemTemplateId).html()),d}),this.initializeFromContainer=override(d.initializeFromContainer,function(){if(!b)return d;var a=null;if("select"==b[0].tagName.toLowerCase()){var c=[];b.find("option").each(function(){var a=$(this),b={Value:a.attr("value"),Text:a.text()};c.push(b)});var e=RS.Utils.getOptionsFromAttributes(b,"data-source-options")||{};c&&(e.Data=c),a=new RS.Controls.DataSource(e)}return d.setDataSource(a),d}),this.initializeHtml=override(d.initializeHtml,function(){return d.Elements.Me?(d.Elements.Popover=d.Elements.Me.find('[role="popover"]:first'),d.Elements.Me.find('[role="dropdown-toggle"]').mousedown(function(){d.toggle()}),d.setContinuousPaginationScrollingParent(d.Elements.List),d):d}),this.selectIndex=override(d.selectIndex,function(a){if(!d.Elements.Me)return d;var b=d.getDefaultTemplate();if(b&&b.SelectedItemTemplateId){b.SelectedItemCompiled=b.SelectedItemCompiled||Handlebars.compile($("#"+b.SelectedItemTemplateId).html());var c=b.SelectedItemCompiled(d.SelectedItem);d.Elements.Me.find('[role="main"]:first').html(c)}return d.Options.CloseAfterSelect&&d.close(),
d}),this.open=function(){return!d.Elements.Me||d.IsOpen?d:(d.IsOpen=!0,d.Elements.Popover&&d.Elements.Popover.show(),d.Options.Search.CanSearch&&d.Elements.Search&&d.Elements.Search.focus(),e||(d.Options.DataSource&&d.Options.DataSource.loadData(),e=!0),$(document).bind("mousedown",f),d.PubSub.triggerEvent("open",{Source:d}),d)},this.close=function(){return d.Elements.Me&&d.IsOpen?(d.IsOpen=!1,d.Elements.Popover&&d.Elements.Popover.hide(),d.Elements.Search&&d.Elements.Search.val(""),lastTerm=null,d.PubSub.triggerEvent("hide",{Source:d}),$(document).unbind("mousedown",f),d):d},this.toggle=function(){return d.IsOpen?d.close():d.open()};var f=function(a){return d.Elements.Me&&d.IsOpen?RS.Utils.isInsideElement({x:a.pageX,y:a.pageY},d.Elements.List)||RS.Utils.isInsideElement({x:a.pageX,y:a.pageY},d.Elements.Me)?void 0:d.close():!0};c||d.initialize(),d.appendTo(b,!0)},extend(RS.Controls.Dropdown,RS.Controls.DataControl),RS.Controls.ButtonDropdown=function(a,b,c){var d=this;this.Options={Templates:[{IsDefault:!0,Id:"button-dropdown-template",ItemTemplateId:"button-dropdown-item-template"}],CanHighlight:!1,Text:"Action"},a&&(d.Options=$.extend(d.Options,a)),RS.Controls.ButtonDropdown.superclass.constructor.call(this,d.Options,b,!0),this.Button=null,this.initialize=override(d.initialize,function(){return console.log("buttondropdown"),d}),this.initializeHtml=override(d.initializeHtml,function(){if(!d.Elements.Me)return d;var a=RS.Core.copy(d.Options,!0);return a.KeepOptionsFromStart=!0,d.Button=new RS.Controls.Button(a,d.Elements.Me.find('[role="dropdown-toggle"]:first')),d}),c||d.initialize()},extend(RS.Controls.ButtonDropdown,RS.Controls.Dropdown),RS.Controls.SplitButton=function(a,b,c){var d=this;this.Options={Templates:[{IsDefault:!0,Id:"splitbutton-template",ItemTemplateId:"splitbutton-item-template"}],CanHighlight:!1,Text:"Action"},a&&(d.Options=$.extend(d.Options,a)),RS.Controls.SplitButton.superclass.constructor.call(this,d.Options,b,!0),this.Button=null,this.DropdownButton=null,this.initialize=override(d.initialize,function(){return console.log("splitbutton"),d}),this.initializeHtml=override(d.initializeHtml,function(){if(!d.Elements.Me)return d;var a=RS.Core.copy(d.Options,!0);return a.KeepOptionsFromStart=!0,d.Button=new RS.Controls.Button(a,d.Elements.Me.find('[role="button"]:first')),a=RS.Core.copy(d.Options,!0),a.KeepOptionsFromStart=!0,d.DropdownButton=new RS.Controls.Button(a,d.Elements.Me.find('[role="dropdown-toggle"]:first')),d}),c||d.initialize()},extend(RS.Controls.SplitButton,RS.Controls.Dropdown),RS.Controls.List=function(a,b,c){var d=this;this.Options={Templates:[{IsDefault:!0,Id:"list-template",ItemTemplateId:"list-item-template"}],Paging:{HasContinuousPagination:!1},CanSelect:!0,CanHighlight:!0},a&&(d.Options=$.extend(d.Options,a)),RS.Controls.List.superclass.constructor.call(this,d.Options,b,!0),this.Elements.Me=null,this.initialize=override(d.initialize,function(){return console.log("list"),d}),this.initializeHtml=override(d.initializeHtml,function(){return d.Elements.Me?(d.Options.DataSource&&d.Options.DataSource.loadData(),d):d}),c||d.initialize(),d.appendTo(b,!0)},extend(RS.Controls.List,RS.Controls.DataControl),RS.Controls.ControlsGenerator=function(){var a=[],b=function(a){a=a||$(document),a.on("DOMNodeInserted",function(a){var b=$(a.target);e(b)})},c=function(b){if(!b)return null;b=b.toLowerCase();for(var c=0;c<a.length;c++){var d=a[c];if(d.Name.toLowerCase()==b)return d}return null},d=function(b,d){var e=c(b);null!=e?e=d:a.push(d)},e=function(a){a=a||$(document),f(a),a.find("[data-control]").each(function(){f($(this))})},f=function(a){if(a&&!a.data("generator-initialized")){a.data("generator-initialized",!0);var b=a.attr("data-control")||"";if(b){var d=c(b);d&&d.build(a)}}};return{listenForControls:function(a){b(a)},generateControl:function(a){f(a)},generateControlsInContainer:function(a){e(a)},registerBuilder:function(a,b){d(a,b)}}}(),RS.Controls.ControlsGenerator.registerBuilder("Container",{Name:"Container",build:function(a){new RS.Controls.Container(null,a)}}),RS.Controls.ControlsGenerator.registerBuilder("Button",{Name:"Button",build:function(a){new RS.Controls.Button(null,a)}}),RS.Controls.ControlsGenerator.registerBuilder("ToggleButton",{Name:"ToggleButton",build:function(a){new RS.Controls.ToggleButton(null,a)}}),RS.Controls.ControlsGenerator.registerBuilder("ButtonGroup",{Name:"ButtonGroup",build:function(a){new RS.Controls.ButtonGroup(null,a)}}),RS.Controls.ControlsGenerator.registerBuilder("Modal",{Name:"Modal",build:function(a){new RS.Controls.ButtonGroup(null,a)}}),RS.Controls.ControlsGenerator.registerBuilder("Tooltip",{Name:"Tooltip",build:function(a){new RS.Controls.Tooltip(null,a)}}),RS.Controls.ControlsGenerator.registerBuilder("Popover",{Name:"Popover",build:function(a){new RS.Controls.Popover(null,a)}}),RS.Controls.ControlsGenerator.registerBuilder("Dropdown",{Name:"Dropdown",build:function(a){new RS.Controls.Dropdown(null,a)}}),RS.Controls.ControlsGenerator.registerBuilder("ButtonDropdown",{Name:"ButtonDropdown",build:function(a){new RS.Controls.ButtonDropdown(null,a)}}),RS.Controls.ControlsGenerator.registerBuilder("SplitButton",{Name:"SplitButton",build:function(a){new RS.Controls.SplitButton(null,a)}}),RS.Controls.ControlsGenerator.registerBuilder("List",{Name:"List",build:function(a){new RS.Controls.List(null,a)}});